<!--

      ━━━━━━神兽出没━━━━━━
         ┌─┐       ┌─┐
      ┌──┘ ┴───────┘ ┴──┐
      │                 │
      │       ---       │
      │  ─┬┘       └┬─  │
      │                 │   Code is far away from bug with the animal protecting.
      │       ─┴─       │   神兽保佑,代码无bug
      │                 │
      └───┐         ┌───┘
          │         │
          │         └──────────────┐
          │                        │
          │                        ├─┐
          │                        ┌─┘
          │                        │
          └─┐  ┐  ┌───────┬──┐  ┌──┘
            │ ─┤ ─┤       │ ─┤ ─┤
            └──┴──┘       └──┴──┘
      ━━━━━━感觉萌萌哒━━━━━━

-->

<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  
  <title>v2ray配置 | Leouas</title>
  <meta name="description" content="冰糖葫芦Sayk" />
  <meta name="keywords" content="冰糖葫芦Sayl,Sakura" />
  
    <link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/xbclub/imageCDN//upload/20200311210331.ico">
  
  <meta http-equiv="x-dns-prefetch-control" content="on">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/xbclub/staticCDN@0.6/css/googlefont.css" media="all">
<!--  <link rel="dns-prefetch" href="//cdn.jsdelivr.net">-->
  <link rel="stylesheet" id="saukra_css-css" href="https://cdn.jsdelivr.net/gh/xbclub/staticCDN@0.6/css/style.css" type="text/css" media="all">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/xbclub/staticCDN@0.6/css/lib.min.css" media="all">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/xbclub/staticCDN@0.6/css/font.css" media="all">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/xbclub/staticCDN@0.6/css/insight.css" media="all">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/xbclub/staticCDN@0.6/css/jquery.fancybox.min.css" media="all">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/xbclub/staticCDN@0.6/css/zoom.css" media="all">
  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/xbclub/staticCDN@0.6/css/sharejs.css">
<!--   <link rel="stylesheet" id="saukra_css-css" href="https://2heng.xin/wp-content/cache/autoptimize/css/autoptimize_ad42a61f4c7d4bdd9f91afcff6b5dda5.css
" type="text/css" media="all"> -->
  <script>
  /*Initial Variables*/
  var mashiro_option = new Object();
  var mashiro_global = new Object();
  mashiro_option.NProgressON = true;
  /* 
   * 邮箱信息之类的东西可以填在这里，这些js变量基本都作用于sakura-app.js
   * 这样的设置仅是为了方便在基于PHP开发的主题中设置js变量，既然移植到了Node上，我想或许可以精简这一逻辑吧
   */
  mashiro_option.email_domain = "";
  mashiro_option.email_name = "";
  mashiro_option.cookie_version_control = "";
  mashiro_option.qzone_autocomplete = false;
  mashiro_option.site_name = "さくら荘そのleouas";
  mashiro_option.author_name = "leouas";
  mashiro_option.site_url = "https://Leouas.top";
  mashiro_option.v_appId = "6ivazxVHEUSEPWeFBgWAE4ii-gzGzoHsz";
  mashiro_option.v_appKey = "2nM0myJBq6NI5ybdaWpo2hm2";
  mashiro_option.mathjax = "0";
  mashiro_option.qq_api_url = "https://api.mashiro.top/qqinfo/"; 
  mashiro_option.qq_avatar_api_url = "https://api.mashiro.top/qqinfo/";

  // mashiro_option.jsdelivr_css_src = "https://cdn.jsdelivr.net/gh/moezx/cdn@3.4.5/css/lib.min.css";
  // mashiro_option.float_player_on = true;

  /*End of Initial Variables*/
  </script>
  <script type="text/javascript">
  var bg = "https://api.ixiaowai.cn/api/api.php,https://cdn.jsdelivr.net/gh/pRzA6/pRzA6/wallpaper-20200422.jpg,https://cdn.jsdelivr.net/gh/pRzA6/pRzA6/公主连接-20200422.jpg,https://cdn.jsdelivr.net/gh/xbclub/CDN@master/manifest/webp/1ac3fa3ef82c93a8d46384e256342711.webp,https://cdn.jsdelivr.net/gh/xbclub/CDN@master/manifest/webp/6f005cbc1865ff1b706aba57347988ab.webp,https://cdn.jsdelivr.net/gh/xbclub/CDN@master/manifest/webp/512a1fded4940ba8d5f215809ff8c153.webp,https://cdn.jsdelivr.net/gh/xbclub/CDN@master/manifest/webp/783bf161f47b32882f0e962fd4064de7.webp,https://cdn.jsdelivr.net/gh/xbclub/CDN@master/manifest/webp/19313b0d62b27c8ba022f60fbfedd5ee.webp,https://cdn.jsdelivr.net/gh/xbclub/CDN@master/manifest/webp/a5fa4f9db760f58fc48f03d66b4967f7.webp,https://cdn.jsdelivr.net/gh/xbclub/CDN@master/manifest/webp/b3e8dae89b950b940dc0edd1e8cc0566.webp,https://cdn.jsdelivr.net/gh/xbclub/CDN@master/manifest/webp/e9f33c2c502ab43804964ce7edd431f9.webp".split(",");
  var bgindex = Math.floor(Math.random()*bg.length);
  if (!!window.ActiveXObject || "ActiveXObject" in window) { //is IE?
    alert('朋友，IE浏览器未适配哦~');
  }
  </script>
  <style type="text/css">
  .hljs-ln{border-collapse:collapse}.hljs-ln td{padding:0}.hljs-ln-n:before{content:attr(data-line-number)}
  </style>
  <style type="text/css">.site-top .lower nav{display:block !important;}.author-profile i,.post-like a,.post-share .show-share,.sub-text,.we-info a,span.sitename,.post-more i:hover,#pagination a:hover,.post-content a:hover,.float-content i:hover{color:#FE9600}.feature i,.download,.navigator i:hover,.links ul li:before,.ar-time i,span.ar-circle,.object,.comment .comment-reply-link,.siren-checkbox-radio:checked + .siren-checkbox-radioInput:after{background:#FE9600}::-webkit-scrollbar-thumb{background:#FE9600}.download,.navigator i:hover,.link-title,.links ul li:hover,#pagination a:hover,.comment-respond input[type='submit']:hover{border-color:#FE9600}.entry-content a:hover,.site-info a:hover,.comment h4 a,#comments-navi a.prev,#comments-navi a.next,.comment h4 a:hover,.site-top ul li a:hover,.entry-title a:hover,#archives-temp h3,span.page-numbers.current,.sorry li a:hover,.site-title a:hover,i.iconfont.js-toggle-search.iconsearch:hover,.comment-respond input[type='submit']:hover{color:#FE9600}.comments .comments-main{display:block !important;}.comments .comments-hidden{display:none !important;}background-position:center center;background-attachment:inherit;}
  </style>

<meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="Leouas" type="application/atom+xml">
</head>

<body class="page-template page-template-user page-template-page-analytics page-template-userpage-analytics-php page page-id-1297 chinese-font serif isWebKit">
  <div class="scrollbar" id="bar">
  </div>
  <a href="#" class="cd-top faa-float animated"></a>
  <section id="main-container">
    <div class="headertop filter-dot">
  <div id="banner_wave_1"></div>
  <div id="banner_wave_2"></div>
  <figure id="centerbg" class="centerbg">
    <div class="focusinfo no-select">
      <div class="header-tou">
        <a href="https://Leouas.top">
          <img src="https://cdn.jsdelivr.net/gh/Leouas/cdn/img/custom/avatar.jpg">
        </a>
      </div>
      <div class="header-info">
        <p>Live your life with passion! With some drive!</p>
        <div class="top-social_v2">
          <li id="bg-pre">
            <img class="flipx" src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/other/next-b.svg">
          </li>
          
            
              
                <li>
                  <a href="http://github.com/Leouas" target="_blank" class="social-github" title="github">
                    <img src="https://cdn.jsdelivr.net/gh/Leouas/cdn/img/social/github.png">
                  </a>
                </li>
              
            
              
                <li>
                  <a href="https://music.163.com/#/user/home?id=1525587938" target="_blank" class="social-github" title="wangyiyun">
                    <img src="https://cdn.jsdelivr.net/gh/Leouas/cdn/img/social/wangyiyun.png">
                  </a>
                </li>
              
            
              
                <li>
                  <a href="https://www.zhihu.com/people/bing-tang-hu-lu-sayk" target="_blank" class="social-github" title="zhihu">
                    <img src="https://cdn.jsdelivr.net/gh/Leouas/cdn/img/social/zhihu.png">
                  </a>
                </li>
              
            
              
                <li>
                  <a href="mailto:Leoua7@163.com" target="_blank" class="social-github" title="email">
                    <img src="https://cdn.jsdelivr.net/gh/Leouas/cdn/img/social/email.svg">
                  </a>
                </li>
              
            
              
                <li class="wechat">
                  <a href="/#">
                    <img src="https://cdn.jsdelivr.net/gh/Leouas/cdn/img/social/qq.png">
                  </a>
                  <div class="wechatInner">
                    <img src="/img/custom/qq.jpg">
                  </div>
                </li>
              
            
              
                <li class="wechat">
                  <a href="/#">
                    <img src="https://cdn.jsdelivr.net/gh/Leouas/cdn/img/social/wechat.png">
                  </a>
                  <div class="wechatInner">
                    <img src="/img/custom/wechat.jpg">
                  </div>
                </li>
              
            
          
          <li id="bg-next">
            <img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/other/next-b.svg">
          </li>
        </div>
      </div>
    </div>
  </figure>
  
    <div id="video-container" style="">
    <video style="object-fit: fill" id="bgvideo" class="video" video-name="" src="" width="auto" preload="auto">
    </video>
    <div id="video-btn" class="loadvideo videolive">
    </div>
    <div id="video-add">
    </div>
    <div class="video-stu">
    </div>
  </div>
  
  <div class="headertop-down faa-float animated" onclick="headertop_down()">
    <span>
      <i class="fa fa-chevron-down" aria-hidden="true">
      </i>
    </span>
  </div>
</div>

    <div id="page" class="site wrapper">
      <header class="site-header no-select gizle sabit" role="banner">
 
  <div class="site-top">
    <div class="site-branding">
      <span class="site-title">
        <span class="logolink moe-mashiro">
          <a href="/">
            <span class="sakurasono">さくら荘その</span>
            <span class="shironeko">leouas</span>
          </a>
        </span>
      </span>
    </div>
    <div class="searchbox search-form-submit">
      <i class="iconfont js-toggle-search iconsearch icon-search">
      </i>
    </div>
    <div id="show-nav" class="showNav mobile-fit">
      <div class="line line1">
      </div>
      <div class="line line2">
      </div>
      <div class="line line3">
      </div>
    </div>
    <div class="lower-cantiner">
      <div class="lower">
        <nav class="mobile-fit-control hide">
          <ul id="menu-new" class="menu">
            
              <li>
                <a href="/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-fort-awesome faa-shake" aria-hidden="true"></i>
                    首页
                  </span>
                </a>
                
              </li>
            
              <li>
                <a href="javascript:;">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-archive faa-shake" aria-hidden="true"></i>
                    分类
                  </span>
                </a>
                
                  <ul class="sub-menu">
                    
                      <li>
                        <a href="/categories/geek/">
                          <i class="fa fa-code" aria-hidden="true"></i>
                          技术
                        </a>
                      </li>
                    
                      <li>
                        <a href="/categories/whut/">
                          <i class="fa fa-file-text-o" aria-hidden="true"></i>
                          学习
                        </a>
                      </li>
                    
                      <li>
                        <a href="/categories/share/">
                          <i class="fa fa-commenting-o" aria-hidden="true"></i>
                          随想
                        </a>
                      </li>
                    
                      <li>
                        <a href="/categories/mics/">
                          <i class="fa fa-music" aria-hidden="true"></i>
                          媒体
                        </a>
                      </li>
                    
                  </ul>
                
              </li>
            
              <li>
                <a href="javascript:;">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-list-ul faa-vertical" aria-hidden="true"></i>
                    清单
                  </span>
                </a>
                
                  <ul class="sub-menu">
                    
                      <li>
                        <a href="/categories/books/">
                          <i class="fa fa-th-list faa-bounce" aria-hidden="true"></i>
                          书单
                        </a>
                      </li>
                    
                      <li>
                        <a href="/bangumi/">
                          <i class="fa fa-film faa-vertical" aria-hidden="true"></i>
                          番组
                        </a>
                      </li>
                    
                      <li>
                        <a href="/playlist/">
                          <i class="fa fa-headphones" aria-hidden="true"></i>
                          歌单
                        </a>
                      </li>
                    
                      <li>
                        <a href="https://huaban.com/sayk/pins/" target="_blank" rel="noopener">
                          <i class="fa fa-photo" aria-hidden="true"></i>
                          图集
                        </a>
                      </li>
                    
                  </ul>
                
              </li>
            
              <li>
                <a href="/archives">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-archive faa-shake" aria-hidden="true"></i>
                    归档
                  </span>
                </a>
                
              </li>
            
              <li>
                <a href="/tags">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-tags" aria-hidden="true"></i>
                    标签
                  </span>
                </a>
                
              </li>
            
              <li>
                <a href="/comment/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-pencil-square-o faa-tada" aria-hidden="true"></i>
                    留言
                  </span>
                </a>
                
              </li>
            
              <li>
                <a href="javascript:;">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-leaf faa-wrench" aria-hidden="true"></i>
                    关于
                  </span>
                </a>
                
                  <ul class="sub-menu">
                    
                      <li>
                        <a href="/donate/">
                          <i class="fa fa-heart faa-pulse" aria-hidden="true"></i>
                          赞赏
                        </a>
                      </li>
                    
                      <li>
                        <a href="/about/">
                          <i class="fa fa-meetup" aria-hidden="true"></i>
                          我？
                        </a>
                      </li>
                    
                  </ul>
                
              </li>
            
              <li>
                <a href="/links/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-link faa-shake" aria-hidden="true"></i>
                    友人帐
                  </span>
                </a>
                
              </li>
            
              <li>
                <a href="/atom.xml">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-rss faa-pulse" aria-hidden="true"></i>
                    RSS
                  </span>
                </a>
                
              </li>
            
          </ul>
        </nav>
      </div>
    </div>
  </div>
</header>

      <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/xbclub/staticCDN@0.6/css/sharejs.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/xbclub/staticCDN@0.6/css/tocbot.css">
<div class="pattern-center-blank"></div> 

<div id="content" class="site-content">
  <div id="primary" class="content-area">
    <main id="main" class="site-main" role="main">
      <article id="post-1" class="post-1 post type-post status-publish format-standard has-post-thumbnail hentry category-uncategorized">
        <div class="toc"></div>
        <!--<div class="toc-entry-content"> --><!-- 套嵌目录使用（主要为了支援评论）-->
        
          <header class="entry-header">
            <h1 class="entry-title">v2ray配置</h1>
            <p class="entry-census">Leouas&nbsp;·&nbsp;2020-5-24&nbsp;
              
                    
        ·<span id="readcount"></span>次阅读
      
            </p>
            <hr>
          </header>
        
        <div class="entry-content">
          <h2 id="安装脚本"><a href="#安装脚本" class="headerlink" title="安装脚本"></a>安装脚本</h2><pre><code class="bash">wget -N --no-check-certificate -q -O install.sh &quot;https://raw.githubusercontent.com/wulabing/V2Ray_ws-tls_bash_onekey/master/install.sh&quot; &amp;&amp; chmod +x install.sh &amp;&amp; bash install.sh</code></pre>
<p><img src="https://imgkr.cn-bj.ufileos.com/efa0d4ce-50e3-4275-bba2-077c55f15af0.png" alt=""></p>
<h2 id="确认时间同步"><a href="#确认时间同步" class="headerlink" title="确认时间同步"></a>确认时间同步</h2><p><img src="https://imgkr.cn-bj.ufileos.com/f9115d28-1721-4afc-98fb-9027642a7d6d.png" alt=""></p>
<h2 id="输入域名信息及端口"><a href="#输入域名信息及端口" class="headerlink" title="输入域名信息及端口"></a>输入域名信息及端口</h2><p>域名需要提前解析至服务器</p>
<p><img src="https://imgkr.cn-bj.ufileos.com/de64c0ac-2e7d-485e-be92-f902f91a1d61.png" alt=""></p>
<p>之后需要等待很长一段时间</p>
<p><img src="https://imgkr.cn-bj.ufileos.com/70364dcb-658d-4072-bf4b-9673920d9873.png" alt=""></p>
<h2 id="安装完成页面"><a href="#安装完成页面" class="headerlink" title="安装完成页面"></a>安装完成页面</h2><p><img src="https://imgkr.cn-bj.ufileos.com/66231046-34c1-47a6-8c1a-a9e4618f488f.png" alt=""></p>
<h2 id="开启bbr加速"><a href="#开启bbr加速" class="headerlink" title="开启bbr加速"></a>开启bbr加速</h2><pre><code>wget --no-check-certificate https://github.com/teddysun/across/raw/master/bbr.sh &amp;&amp; chmod +x bbr.sh &amp;&amp; ./bbr.sh</code></pre><h2 id="脚本内容"><a href="#脚本内容" class="headerlink" title="脚本内容"></a>脚本内容</h2><p>wulabing/V2Ray_ws-tls_bash_onekey install.sh<br><a href="https://raw.githubusercontent.com/wulabing/V2Ray_ws-tls_bash_onekey/master/install.sh" target="_blank" rel="noopener">https://raw.githubusercontent.com/wulabing/V2Ray_ws-tls_bash_onekey/master/install.sh</a></p>
<pre><code>#!/bin/bash
PATH=/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin:~/bin
export PATH

cd &quot;$(
    cd &quot;$(dirname &quot;$0&quot;)&quot; || exit
    pwd
)&quot; || exit
#====================================================
#    System Request:Debian 9+/Ubuntu 18.04+/Centos 7+
#    Author:    wulabing
#    Dscription: V2ray ws+tls onekey Management
#    Version: 1.0
#    email:admin@wulabing.com
#    Official document: www.v2ray.com
#====================================================

#fonts color
Green=&quot;\033[32m&quot;
Red=&quot;\033[31m&quot;
# Yellow=&quot;\033[33m&quot;
GreenBG=&quot;\033[42;37m&quot;
RedBG=&quot;\033[41;37m&quot;
Font=&quot;\033[0m&quot;

#notification information
# Info=&quot;${Green}[信息]${Font}&quot;
OK=&quot;${Green}[OK]${Font}&quot;
Error=&quot;${Red}[错误]${Font}&quot;

# 版本
shell_version=&quot;1.1.3.4&quot;
shell_mode=&quot;None&quot;
github_branch=&quot;master&quot;
version_cmp=&quot;/tmp/version_cmp.tmp&quot;
v2ray_conf_dir=&quot;/etc/v2ray&quot;
nginx_conf_dir=&quot;/etc/nginx/conf/conf.d&quot;
v2ray_conf=&quot;${v2ray_conf_dir}/config.json&quot;
nginx_conf=&quot;${nginx_conf_dir}/v2ray.conf&quot;
nginx_dir=&quot;/etc/nginx&quot;
web_dir=&quot;/home/wwwroot&quot;
nginx_openssl_src=&quot;/usr/local/src&quot;
v2ray_bin_dir=&quot;/usr/bin/v2ray&quot;
v2ray_info_file=&quot;$HOME/v2ray_info.inf&quot;
v2ray_qr_config_file=&quot;/usr/local/vmess_qr.json&quot;
nginx_systemd_file=&quot;/etc/systemd/system/nginx.service&quot;
v2ray_systemd_file=&quot;/etc/systemd/system/v2ray.service&quot;
v2ray_access_log=&quot;/var/log/v2ray/access.log&quot;
v2ray_error_log=&quot;/var/log/v2ray/error.log&quot;
amce_sh_file=&quot;/root/.acme.sh/acme.sh&quot;
ssl_update_file=&quot;/usr/bin/ssl_update.sh&quot;
nginx_version=&quot;1.16.1&quot;
openssl_version=&quot;1.1.1g&quot;
jemalloc_version=&quot;5.2.1&quot;
old_config_status=&quot;off&quot;
# v2ray_plugin_version=&quot;$(wget -qO- &quot;https://github.com/shadowsocks/v2ray-plugin/tags&quot; | grep -E &quot;/shadowsocks/v2ray-plugin/releases/tag/&quot; | head -1 | sed -r &#39;s/.*tag\/v(.+)\&quot;&gt;.*/\1/&#39;)&quot;

#移动旧版本配置信息 对小于 1.1.0 版本适配
[[ -f &quot;/etc/v2ray/vmess_qr.json&quot; ]] &amp;&amp; mv /etc/v2ray/vmess_qr.json $v2ray_qr_config_file

#生成伪装路径
camouflage=&quot;/$(head -n 10 /dev/urandom | md5sum | head -c 8)/&quot;

source &#39;/etc/os-release&#39;

#从VERSION中提取发行版系统的英文名称，为了在debian/ubuntu下添加相对应的Nginx apt源
VERSION=$(echo &quot;${VERSION}&quot; | awk -F &quot;[()]&quot; &#39;{print $2}&#39;)

check_system() {
    if [[ &quot;${ID}&quot; == &quot;centos&quot; &amp;&amp; ${VERSION_ID} -ge 7 ]]; then
        echo -e &quot;${OK} ${GreenBG} 当前系统为 Centos ${VERSION_ID} ${VERSION} ${Font}&quot;
        INS=&quot;yum&quot;
    elif [[ &quot;${ID}&quot; == &quot;debian&quot; &amp;&amp; ${VERSION_ID} -ge 8 ]]; then
        echo -e &quot;${OK} ${GreenBG} 当前系统为 Debian ${VERSION_ID} ${VERSION} ${Font}&quot;
        INS=&quot;apt&quot;
        $INS update
        ## 添加 Nginx apt源
    elif [[ &quot;${ID}&quot; == &quot;ubuntu&quot; &amp;&amp; $(echo &quot;${VERSION_ID}&quot; | cut -d &#39;.&#39; -f1) -ge 16 ]]; then
        echo -e &quot;${OK} ${GreenBG} 当前系统为 Ubuntu ${VERSION_ID} ${UBUNTU_CODENAME} ${Font}&quot;
        INS=&quot;apt&quot;
        $INS update
    else
        echo -e &quot;${Error} ${RedBG} 当前系统为 ${ID} ${VERSION_ID} 不在支持的系统列表内，安装中断 ${Font}&quot;
        exit 1
    fi

    $INS install dbus

    systemctl stop firewalld
    systemctl disable firewalld
    echo -e &quot;${OK} ${GreenBG} firewalld 已关闭 ${Font}&quot;

    systemctl stop ufw
    systemctl disable ufw
    echo -e &quot;${OK} ${GreenBG} ufw 已关闭 ${Font}&quot;
}

is_root() {
    if [ 0 == $UID ]; then
        echo -e &quot;${OK} ${GreenBG} 当前用户是root用户，进入安装流程 ${Font}&quot;
        sleep 3
    else
        echo -e &quot;${Error} ${RedBG} 当前用户不是root用户，请切换到root用户后重新执行脚本 ${Font}&quot;
        exit 1
    fi
}
judge() {
    if [[ 0 -eq $? ]]; then
        echo -e &quot;${OK} ${GreenBG} $1 完成 ${Font}&quot;
        sleep 1
    else
        echo -e &quot;${Error} ${RedBG} $1 失败${Font}&quot;
        exit 1
    fi
}
chrony_install() {
    ${INS} -y install chrony
    judge &quot;安装 chrony 时间同步服务 &quot;

    timedatectl set-ntp true

    if [[ &quot;${ID}&quot; == &quot;centos&quot; ]]; then
        systemctl enable chronyd &amp;&amp; systemctl restart chronyd
    else
        systemctl enable chrony &amp;&amp; systemctl restart chrony
    fi

    judge &quot;chronyd 启动 &quot;

    timedatectl set-timezone Asia/Shanghai

    echo -e &quot;${OK} ${GreenBG} 等待时间同步 ${Font}&quot;
    sleep 10

    chronyc sourcestats -v
    chronyc tracking -v
    date
    read -rp &quot;请确认时间是否准确,误差范围±3分钟(Y/N): &quot; chrony_install
    [[ -z ${chrony_install} ]] &amp;&amp; chrony_install=&quot;Y&quot;
    case $chrony_install in
    [yY][eE][sS] | [yY])
        echo -e &quot;${GreenBG} 继续安装 ${Font}&quot;
        sleep 2
        ;;
    *)
        echo -e &quot;${RedBG} 安装终止 ${Font}&quot;
        exit 2
        ;;
    esac
}

dependency_install() {
    ${INS} install wget git lsof -y

    if [[ &quot;${ID}&quot; == &quot;centos&quot; ]]; then
        ${INS} -y install crontabs
    else
        ${INS} -y install cron
    fi
    judge &quot;安装 crontab&quot;

    if [[ &quot;${ID}&quot; == &quot;centos&quot; ]]; then
        touch /var/spool/cron/root &amp;&amp; chmod 600 /var/spool/cron/root
        systemctl start crond &amp;&amp; systemctl enable crond
    else
        touch /var/spool/cron/crontabs/root &amp;&amp; chmod 600 /var/spool/cron/crontabs/root
        systemctl start cron &amp;&amp; systemctl enable cron

    fi
    judge &quot;crontab 自启动配置 &quot;

    ${INS} -y install bc
    judge &quot;安装 bc&quot;

    ${INS} -y install unzip
    judge &quot;安装 unzip&quot;

    ${INS} -y install qrencode
    judge &quot;安装 qrencode&quot;

    ${INS} -y install curl
    judge &quot;安装 crul&quot;

    if [[ &quot;${ID}&quot; == &quot;centos&quot; ]]; then
        ${INS} -y groupinstall &quot;Development tools&quot;
    else
        ${INS} -y install build-essential
    fi
    judge &quot;编译工具包 安装&quot;

    if [[ &quot;${ID}&quot; == &quot;centos&quot; ]]; then
        ${INS} -y install pcre pcre-devel zlib-devel epel-release
    else
        ${INS} -y install libpcre3 libpcre3-dev zlib1g-dev dbus
    fi

    #    ${INS} -y install rng-tools
    #    judge &quot;rng-tools 安装&quot;

    ${INS} -y install haveged
    #    judge &quot;haveged 安装&quot;

    #    sed -i -r &#39;/^HRNGDEVICE/d;/#HRNGDEVICE=\/dev\/null/a HRNGDEVICE=/dev/urandom&#39; /etc/default/rng-tools

    if [[ &quot;${ID}&quot; == &quot;centos&quot; ]]; then
        #       systemctl start rngd &amp;&amp; systemctl enable rngd
        #       judge &quot;rng-tools 启动&quot;
        systemctl start haveged &amp;&amp; systemctl enable haveged
        #       judge &quot;haveged 启动&quot;
    else
        #       systemctl start rng-tools &amp;&amp; systemctl enable rng-tools
        #       judge &quot;rng-tools 启动&quot;
        systemctl start haveged &amp;&amp; systemctl enable haveged
        #       judge &quot;haveged 启动&quot;
    fi
}
basic_optimization() {
    # 最大文件打开数
    sed -i &#39;/^\*\ *soft\ *nofile\ *[[:digit:]]*/d&#39; /etc/security/limits.conf
    sed -i &#39;/^\*\ *hard\ *nofile\ *[[:digit:]]*/d&#39; /etc/security/limits.conf
    echo &#39;* soft nofile 65536&#39; &gt;&gt;/etc/security/limits.conf
    echo &#39;* hard nofile 65536&#39; &gt;&gt;/etc/security/limits.conf

    # 关闭 Selinux
    if [[ &quot;${ID}&quot; == &quot;centos&quot; ]]; then
        sed -i &#39;s/^SELINUX=.*/SELINUX=disabled/&#39; /etc/selinux/config
        setenforce 0
    fi

}
port_alterid_set() {
    if [[ &quot;on&quot; != &quot;$old_config_status&quot; ]]; then
        read -rp &quot;请输入连接端口（default:443）:&quot; port
        [[ -z ${port} ]] &amp;&amp; port=&quot;443&quot;
        read -rp &quot;请输入alterID（default:2 仅允许填数字）:&quot; alterID
        [[ -z ${alterID} ]] &amp;&amp; alterID=&quot;2&quot;
    fi
}
modify_path() {
    if [[ &quot;on&quot; == &quot;$old_config_status&quot; ]]; then
        camouflage=&quot;$(grep &#39;\&quot;path\&quot;&#39; $v2ray_qr_config_file | awk -F &#39;&quot;&#39; &#39;{print $4}&#39;)&quot;
    fi
    sed -i &quot;/\&quot;path\&quot;/c \\\t  \&quot;path\&quot;:\&quot;${camouflage}\&quot;&quot; ${v2ray_conf}
    judge &quot;V2ray 伪装路径 修改&quot;
}
modify_alterid() {
    if [[ &quot;on&quot; == &quot;$old_config_status&quot; ]]; then
        alterID=&quot;$(grep &#39;\&quot;aid\&quot;&#39; $v2ray_qr_config_file | awk -F &#39;&quot;&#39; &#39;{print $4}&#39;)&quot;
    fi
    sed -i &quot;/\&quot;alterId\&quot;/c \\\t  \&quot;alterId\&quot;:${alterID}&quot; ${v2ray_conf}
    judge &quot;V2ray alterid 修改&quot;
    [ -f ${v2ray_qr_config_file} ] &amp;&amp; sed -i &quot;/\&quot;aid\&quot;/c \\  \&quot;aid\&quot;: \&quot;${alterID}\&quot;,&quot; ${v2ray_qr_config_file}
    echo -e &quot;${OK} ${GreenBG} alterID:${alterID} ${Font}&quot;
}
modify_inbound_port() {
    if [[ &quot;on&quot; == &quot;$old_config_status&quot; ]]; then
        port=&quot;$(info_extraction &#39;\&quot;port\&quot;&#39;)&quot;
    fi
    if [[ &quot;$shell_mode&quot; != &quot;h2&quot; ]]; then
        PORT=$((RANDOM + 10000))
        sed -i &quot;/\&quot;port\&quot;/c  \    \&quot;port\&quot;:${PORT},&quot; ${v2ray_conf}
    else
        sed -i &quot;/\&quot;port\&quot;/c  \    \&quot;port\&quot;:${port},&quot; ${v2ray_conf}
    fi
    judge &quot;V2ray inbound_port 修改&quot;
}
modify_UUID() {
    [ -z &quot;$UUID&quot; ] &amp;&amp; UUID=$(cat /proc/sys/kernel/random/uuid)
    if [[ &quot;on&quot; == &quot;$old_config_status&quot; ]]; then
        UUID=&quot;$(info_extraction &#39;\&quot;id\&quot;&#39;)&quot;
    fi
    sed -i &quot;/\&quot;id\&quot;/c \\\t  \&quot;id\&quot;:\&quot;${UUID}\&quot;,&quot; ${v2ray_conf}
    judge &quot;V2ray UUID 修改&quot;
    [ -f ${v2ray_qr_config_file} ] &amp;&amp; sed -i &quot;/\&quot;id\&quot;/c \\  \&quot;id\&quot;: \&quot;${UUID}\&quot;,&quot; ${v2ray_qr_config_file}
    echo -e &quot;${OK} ${GreenBG} UUID:${UUID} ${Font}&quot;
}
modify_nginx_port() {
    if [[ &quot;on&quot; == &quot;$old_config_status&quot; ]]; then
        port=&quot;$(info_extraction &#39;\&quot;port\&quot;&#39;)&quot;
    fi
    sed -i &quot;/ssl http2;$/c \\\tlisten ${port} ssl http2;&quot; ${nginx_conf}
    judge &quot;V2ray port 修改&quot;
    [ -f ${v2ray_qr_config_file} ] &amp;&amp; sed -i &quot;/\&quot;port\&quot;/c \\  \&quot;port\&quot;: \&quot;${port}\&quot;,&quot; ${v2ray_qr_config_file}
    echo -e &quot;${OK} ${GreenBG} 端口号:${port} ${Font}&quot;
}
modify_nginx_other() {
    sed -i &quot;/server_name/c \\\tserver_name ${domain};&quot; ${nginx_conf}
    sed -i &quot;/location/c \\\tlocation ${camouflage}&quot; ${nginx_conf}
    sed -i &quot;/proxy_pass/c \\\tproxy_pass http://127.0.0.1:${PORT};&quot; ${nginx_conf}
    sed -i &quot;/return/c \\\treturn 301 https://${domain}\$request_uri;&quot; ${nginx_conf}
    #sed -i &quot;27i \\\tproxy_intercept_errors on;&quot;  ${nginx_dir}/conf/nginx.conf
}
web_camouflage() {
    ##请注意 这里和LNMP脚本的默认路径冲突，千万不要在安装了LNMP的环境下使用本脚本，否则后果自负
    rm -rf /home/wwwroot
    mkdir -p /home/wwwroot
    cd /home/wwwroot || exit
    git clone https://github.com/wulabing/3DCEList.git
    judge &quot;web 站点伪装&quot;
}
v2ray_install() {
    if [[ -d /root/v2ray ]]; then
        rm -rf /root/v2ray
    fi
    if [[ -d /etc/v2ray ]]; then
        rm -rf /etc/v2ray
    fi
    mkdir -p /root/v2ray
    cd /root/v2ray || exit
    wget -N --no-check-certificate https://install.direct/go.sh

    ## wget http://install.direct/go.sh

    if [[ -f go.sh ]]; then
        rm -rf $v2ray_systemd_file
        systemctl daemon-reload
        bash go.sh --force
        judge &quot;安装 V2ray&quot;
    else
        echo -e &quot;${Error} ${RedBG} V2ray 安装文件下载失败，请检查下载地址是否可用 ${Font}&quot;
        exit 4
    fi
    # 清除临时文件
    rm -rf /root/v2ray
}
nginx_exist_check() {
    if [[ -f &quot;/etc/nginx/sbin/nginx&quot; ]]; then
        echo -e &quot;${OK} ${GreenBG} Nginx已存在，跳过编译安装过程 ${Font}&quot;
        sleep 2
    elif [[ -d &quot;/usr/local/nginx/&quot; ]]; then
        echo -e &quot;${OK} ${GreenBG} 检测到其他套件安装的Nginx，继续安装会造成冲突，请处理后安装${Font}&quot;
        exit 1
    else
        nginx_install
    fi
}
nginx_install() {
    #    if [[ -d &quot;/etc/nginx&quot; ]];then
    #        rm -rf /etc/nginx
    #    fi

    wget -nc --no-check-certificate http://nginx.org/download/nginx-${nginx_version}.tar.gz -P ${nginx_openssl_src}
    judge &quot;Nginx 下载&quot;
    wget -nc --no-check-certificate https://www.openssl.org/source/openssl-${openssl_version}.tar.gz -P ${nginx_openssl_src}
    judge &quot;openssl 下载&quot;
    wget -nc --no-check-certificate https://github.com/jemalloc/jemalloc/releases/download/${jemalloc_version}/jemalloc-${jemalloc_version}.tar.bz2 -P ${nginx_openssl_src}
    judge &quot;jemalloc 下载&quot;

    cd ${nginx_openssl_src} || exit

    [[ -d nginx-&quot;$nginx_version&quot; ]] &amp;&amp; rm -rf nginx-&quot;$nginx_version&quot;
    tar -zxvf nginx-&quot;$nginx_version&quot;.tar.gz

    [[ -d openssl-&quot;$openssl_version&quot; ]] &amp;&amp; rm -rf openssl-&quot;$openssl_version&quot;
    tar -zxvf openssl-&quot;$openssl_version&quot;.tar.gz

    [[ -d jemalloc-&quot;${jemalloc_version}&quot; ]] &amp;&amp; rm -rf jemalloc-&quot;${jemalloc_version}&quot;
    tar -xvf jemalloc-&quot;${jemalloc_version}&quot;.tar.bz2

    [[ -d &quot;$nginx_dir&quot; ]] &amp;&amp; rm -rf ${nginx_dir}

    echo -e &quot;${OK} ${GreenBG} 即将开始编译安装 jemalloc ${Font}&quot;
    sleep 2

    cd jemalloc-${jemalloc_version} || exit
    ./configure
    judge &quot;编译检查&quot;
    make &amp;&amp; make install
    judge &quot;jemalloc 编译安装&quot;
    echo &#39;/usr/local/lib&#39; &gt;/etc/ld.so.conf.d/local.conf
    ldconfig

    echo -e &quot;${OK} ${GreenBG} 即将开始编译安装 Nginx, 过程稍久，请耐心等待 ${Font}&quot;
    sleep 4

    cd ../nginx-${nginx_version} || exit

    ./configure --prefix=&quot;${nginx_dir}&quot; \
        --with-http_ssl_module \
        --with-http_gzip_static_module \
        --with-http_stub_status_module \
        --with-pcre \
        --with-http_realip_module \
        --with-http_flv_module \
        --with-http_mp4_module \
        --with-http_secure_link_module \
        --with-http_v2_module \
        --with-cc-opt=&#39;-O3&#39; \
        --with-ld-opt=&quot;-ljemalloc&quot; \
        --with-openssl=../openssl-&quot;$openssl_version&quot;
    judge &quot;编译检查&quot;
    make &amp;&amp; make install
    judge &quot;Nginx 编译安装&quot;

    # 修改基本配置
    sed -i &#39;s/#user  nobody;/user  root;/&#39; ${nginx_dir}/conf/nginx.conf
    sed -i &#39;s/worker_processes  1;/worker_processes  3;/&#39; ${nginx_dir}/conf/nginx.conf
    sed -i &#39;s/    worker_connections  1024;/    worker_connections  4096;/&#39; ${nginx_dir}/conf/nginx.conf
    sed -i &#39;$i include conf.d/*.conf;&#39; ${nginx_dir}/conf/nginx.conf

    # 删除临时文件
    rm -rf ../nginx-&quot;${nginx_version}&quot;
    rm -rf ../openssl-&quot;${openssl_version}&quot;
    rm -rf ../nginx-&quot;${nginx_version}&quot;.tar.gz
    rm -rf ../openssl-&quot;${openssl_version}&quot;.tar.gz

    # 添加配置文件夹，适配旧版脚本
    mkdir ${nginx_dir}/conf/conf.d
}
ssl_install() {
    if [[ &quot;${ID}&quot; == &quot;centos&quot; ]]; then
        ${INS} install socat nc -y
    else
        ${INS} install socat netcat -y
    fi
    judge &quot;安装 SSL 证书生成脚本依赖&quot;

    curl https://get.acme.sh | sh
    judge &quot;安装 SSL 证书生成脚本&quot;
}
domain_check() {
    read -rp &quot;请输入你的域名信息(eg:www.wulabing.com):&quot; domain
    domain_ip=$(ping &quot;${domain}&quot; -c 1 | sed &#39;1{s/[^(]*(//;s/).*//;q}&#39;)
    echo -e &quot;${OK} ${GreenBG} 正在获取 公网ip 信息，请耐心等待 ${Font}&quot;
    local_ip=$(curl -4 ip.sb)
    echo -e &quot;域名dns解析IP：${domain_ip}&quot;
    echo -e &quot;本机IP: ${local_ip}&quot;
    sleep 2
    if [[ $(echo &quot;${local_ip}&quot; | tr &#39;.&#39; &#39;+&#39; | bc) -eq $(echo &quot;${domain_ip}&quot; | tr &#39;.&#39; &#39;+&#39; | bc) ]]; then
        echo -e &quot;${OK} ${GreenBG} 域名dns解析IP 与 本机IP 匹配 ${Font}&quot;
        sleep 2
    else
        echo -e &quot;${Error} ${RedBG} 请确保域名添加了正确的 A 记录，否则将无法正常使用 V2ray ${Font}&quot;
        echo -e &quot;${Error} ${RedBG} 域名dns解析IP 与 本机IP 不匹配 是否继续安装？（y/n）${Font}&quot; &amp;&amp; read -r install
        case $install in
        [yY][eE][sS] | [yY])
            echo -e &quot;${GreenBG} 继续安装 ${Font}&quot;
            sleep 2
            ;;
        *)
            echo -e &quot;${RedBG} 安装终止 ${Font}&quot;
            exit 2
            ;;
        esac
    fi
}

port_exist_check() {
    if [[ 0 -eq $(lsof -i:&quot;$1&quot; | grep -i -c &quot;listen&quot;) ]]; then
        echo -e &quot;${OK} ${GreenBG} $1 端口未被占用 ${Font}&quot;
        sleep 1
    else
        echo -e &quot;${Error} ${RedBG} 检测到 $1 端口被占用，以下为 $1 端口占用信息 ${Font}&quot;
        lsof -i:&quot;$1&quot;
        echo -e &quot;${OK} ${GreenBG} 5s 后将尝试自动 kill 占用进程 ${Font}&quot;
        sleep 5
        lsof -i:&quot;$1&quot; | awk &#39;{print $2}&#39; | grep -v &quot;PID&quot; | xargs kill -9
        echo -e &quot;${OK} ${GreenBG} kill 完成 ${Font}&quot;
        sleep 1
    fi
}
acme() {
    if &quot;$HOME&quot;/.acme.sh/acme.sh --issue -d &quot;${domain}&quot; --standalone -k ec-256 --force --test; then
        echo -e &quot;${OK} ${GreenBG} SSL 证书测试签发成功，开始正式签发 ${Font}&quot;
        rm -rf &quot;$HOME/.acme.sh/${domain}_ecc&quot;
        sleep 2
    else
        echo -e &quot;${Error} ${RedBG} SSL 证书测试签发失败 ${Font}&quot;
        rm -rf &quot;$HOME/.acme.sh/${domain}_ecc&quot;
        exit 1
    fi

    if &quot;$HOME&quot;/.acme.sh/acme.sh --issue -d &quot;${domain}&quot; --standalone -k ec-256 --force; then
        echo -e &quot;${OK} ${GreenBG} SSL 证书生成成功 ${Font}&quot;
        sleep 2
        mkdir /data
        if &quot;$HOME&quot;/.acme.sh/acme.sh --installcert -d &quot;${domain}&quot; --fullchainpath /data/v2ray.crt --keypath /data/v2ray.key --ecc --force; then
            echo -e &quot;${OK} ${GreenBG} 证书配置成功 ${Font}&quot;
            sleep 2
        fi
    else
        echo -e &quot;${Error} ${RedBG} SSL 证书生成失败 ${Font}&quot;
        rm -rf &quot;$HOME/.acme.sh/${domain}_ecc&quot;
        exit 1
    fi
}
v2ray_conf_add_tls() {
    cd /etc/v2ray || exit
    wget --no-check-certificate https://raw.githubusercontent.com/wulabing/V2Ray_ws-tls_bash_onekey/${github_branch}/tls/config.json -O config.json
    modify_path
    modify_alterid
    modify_inbound_port
    modify_UUID
}
v2ray_conf_add_h2() {
    cd /etc/v2ray || exit
    wget --no-check-certificate https://raw.githubusercontent.com/wulabing/V2Ray_ws-tls_bash_onekey/${github_branch}/http2/config.json -O config.json
    modify_path
    modify_alterid
    modify_inbound_port
    modify_UUID
}
old_config_exist_check() {
    if [[ -f $v2ray_qr_config_file ]]; then
        echo -e &quot;${OK} ${GreenBG} 检测到旧配置文件，是否读取旧文件配置 [Y/N]? ${Font}&quot;
        read -r ssl_delete
        case $ssl_delete in
        [yY][eE][sS] | [yY])
            echo -e &quot;${OK} ${GreenBG} 已保留旧配置  ${Font}&quot;
            old_config_status=&quot;on&quot;
            port=$(info_extraction &#39;\&quot;port\&quot;&#39;)
            ;;
        *)
            rm -rf $v2ray_qr_config_file
            echo -e &quot;${OK} ${GreenBG} 已删除旧配置  ${Font}&quot;
            ;;
        esac
    fi
}
nginx_conf_add() {
    touch ${nginx_conf_dir}/v2ray.conf
    cat &gt;${nginx_conf_dir}/v2ray.conf &lt;&lt;EOF
    server {
        listen 443 ssl http2;
        ssl_certificate       /data/v2ray.crt;
        ssl_certificate_key   /data/v2ray.key;
        ssl_protocols         TLSv1.3;
        ssl_ciphers           TLS13-AES-256-GCM-SHA384:TLS13-CHACHA20-POLY1305-SHA256:TLS13-AES-128-GCM-SHA256:TLS13-AES-128-CCM-8-SHA256:TLS13-AES-128-CCM-SHA256:EECDH+CHACHA20:EECDH+CHACHA20-draft:EECDH+ECDSA+AES128:EECDH+aRSA+AES128:RSA+AES128:EECDH+ECDSA+AES256:EECDH+aRSA+AES256:RSA+AES256:EECDH+ECDSA+3DES:EECDH+aRSA+3DES:RSA+3DES:!MD5;
        server_name           serveraddr.com;
        index index.html index.htm;
        root  /home/wwwroot/3DCEList;
        error_page 400 = /400.html;
        location /ray/
        {
        proxy_redirect off;
        proxy_pass http://127.0.0.1:10000;
        proxy_http_version 1.1;
        proxy_set_header X-Real-IP \$remote_addr;
        proxy_set_header X-Forwarded-For \$proxy_add_x_forwarded_for;
        proxy_set_header Upgrade \$http_upgrade;
        proxy_set_header Connection &quot;upgrade&quot;;
        proxy_set_header Host \$http_host;
        }
}
    server {
        listen 80;
        server_name serveraddr.com;
        return 301 https://use.shadowsocksr.win\$request_uri;
    }
EOF

    modify_nginx_port
    modify_nginx_other
    judge &quot;Nginx 配置修改&quot;

}

start_process_systemd() {
    systemctl daemon-reload
    if [[ &quot;$shell_mode&quot; != &quot;h2&quot; ]]; then
        systemctl restart nginx
        judge &quot;Nginx 启动&quot;
    fi
    systemctl restart v2ray
    judge &quot;V2ray 启动&quot;
}

enable_process_systemd() {
    systemctl enable v2ray
    judge &quot;设置 v2ray 开机自启&quot;
    if [[ &quot;$shell_mode&quot; != &quot;h2&quot; ]]; then
        systemctl enable nginx
        judge &quot;设置 Nginx 开机自启&quot;
    fi

}

stop_process_systemd() {
    if [[ &quot;$shell_mode&quot; != &quot;h2&quot; ]]; then
        systemctl stop nginx
    fi
    systemctl stop v2ray
}
nginx_process_disabled() {
    [ -f $nginx_systemd_file ] &amp;&amp; systemctl stop nginx &amp;&amp; systemctl disable nginx
}

#debian 系 9 10 适配
#rc_local_initialization(){
#    if [[ -f /etc/rc.local ]];then
#        chmod +x /etc/rc.local
#    else
#        touch /etc/rc.local &amp;&amp; chmod +x /etc/rc.local
#        echo &quot;#!/bin/bash&quot; &gt;&gt; /etc/rc.local
#        systemctl start rc-local
#    fi
#
#    judge &quot;rc.local 配置&quot;
#}
acme_cron_update() {
    wget -N -P /usr/bin --no-check-certificate &quot;https://raw.githubusercontent.com/wulabing/V2Ray_ws-tls_bash_onekey/dev/ssl_update.sh&quot;
    if [[ &quot;${ID}&quot; == &quot;centos&quot; ]]; then
        #        sed -i &quot;/acme.sh/c 0 3 * * 0 \&quot;/root/.acme.sh\&quot;/acme.sh --cron --home \&quot;/root/.acme.sh\&quot; \
        #        &amp;&gt; /dev/null&quot; /var/spool/cron/root
        sed -i &quot;/acme.sh/c 0 3 * * 0 bash ${ssl_update_file}&quot; /var/spool/cron/root
    else
        #        sed -i &quot;/acme.sh/c 0 3 * * 0 \&quot;/root/.acme.sh\&quot;/acme.sh --cron --home \&quot;/root/.acme.sh\&quot; \
        #        &amp;&gt; /dev/null&quot; /var/spool/cron/crontabs/root
        sed -i &quot;/acme.sh/c 0 3 * * 0 bash ${ssl_update_file}&quot; /var/spool/cron/crontabs/root
    fi
    judge &quot;cron 计划任务更新&quot;
}

vmess_qr_config_tls_ws() {
    cat &gt;$v2ray_qr_config_file &lt;&lt;-EOF
{
  &quot;v&quot;: &quot;2&quot;,
  &quot;ps&quot;: &quot;wulabing_${domain}&quot;,
  &quot;add&quot;: &quot;${domain}&quot;,
  &quot;port&quot;: &quot;${port}&quot;,
  &quot;id&quot;: &quot;${UUID}&quot;,
  &quot;aid&quot;: &quot;${alterID}&quot;,
  &quot;net&quot;: &quot;ws&quot;,
  &quot;type&quot;: &quot;none&quot;,
  &quot;host&quot;: &quot;${domain}&quot;,
  &quot;path&quot;: &quot;${camouflage}&quot;,
  &quot;tls&quot;: &quot;tls&quot;
}
EOF
}

vmess_qr_config_h2() {
    cat &gt;$v2ray_qr_config_file &lt;&lt;-EOF
{
  &quot;v&quot;: &quot;2&quot;,
  &quot;ps&quot;: &quot;wulabing_${domain}&quot;,
  &quot;add&quot;: &quot;${domain}&quot;,
  &quot;port&quot;: &quot;${port}&quot;,
  &quot;id&quot;: &quot;${UUID}&quot;,
  &quot;aid&quot;: &quot;${alterID}&quot;,
  &quot;net&quot;: &quot;h2&quot;,
  &quot;type&quot;: &quot;none&quot;,
  &quot;path&quot;: &quot;${camouflage}&quot;,
  &quot;tls&quot;: &quot;tls&quot;
}
EOF
}

vmess_qr_link_image() {
    vmess_link=&quot;vmess://$(base64 -w 0 $v2ray_qr_config_file)&quot;
    {
        echo -e &quot;$Red 二维码: $Font&quot;
        echo -n &quot;${vmess_link}&quot; | qrencode -o - -t utf8
        echo -e &quot;${Red} URL导入链接:${vmess_link} ${Font}&quot;
    } &gt;&gt;&quot;${v2ray_info_file}&quot;
}

info_extraction() {
    grep &quot;$1&quot; $v2ray_qr_config_file | awk -F &#39;&quot;&#39; &#39;{print $4}&#39;
}
basic_information() {
    {
        echo -e &quot;${OK} ${GreenBG} V2ray+ws+tls 安装成功&quot;
        echo -e &quot;${Red} V2ray 配置信息 ${Font}&quot;
        echo -e &quot;${Red} 地址（address）:${Font} $(info_extraction &#39;\&quot;add\&quot;&#39;) &quot;
        echo -e &quot;${Red} 端口（port）：${Font} $(info_extraction &#39;\&quot;port\&quot;&#39;) &quot;
        echo -e &quot;${Red} 用户id（UUID）：${Font} $(info_extraction &#39;\&quot;id\&quot;&#39;)&quot;
        echo -e &quot;${Red} 额外id（alterId）：${Font} $(info_extraction &#39;\&quot;aid\&quot;&#39;)&quot;
        echo -e &quot;${Red} 加密方式（security）：${Font} 自适应 &quot;
        echo -e &quot;${Red} 传输协议（network）：${Font} $(info_extraction &#39;\&quot;net\&quot;&#39;) &quot;
        echo -e &quot;${Red} 伪装类型（type）：${Font} none &quot;
        echo -e &quot;${Red} 路径（不要落下/）：${Font} $(info_extraction &#39;\&quot;path\&quot;&#39;) &quot;
        echo -e &quot;${Red} 底层传输安全：${Font} tls &quot;
    } &gt;&quot;${v2ray_info_file}&quot;
}
show_information() {
    cat &quot;${v2ray_info_file}&quot;
}
ssl_judge_and_install() {
    if [[ -f &quot;/data/v2ray.key&quot; || -f &quot;/data/v2ray.crt&quot; ]]; then
        echo &quot;/data 目录下证书文件已存在&quot;
        echo -e &quot;${OK} ${GreenBG} 是否删除 [Y/N]? ${Font}&quot;
        read -r ssl_delete
        case $ssl_delete in
        [yY][eE][sS] | [yY])
            rm -rf /data/*
            echo -e &quot;${OK} ${GreenBG} 已删除 ${Font}&quot;
            ;;
        *) ;;

        esac
    fi

    if [[ -f &quot;/data/v2ray.key&quot; || -f &quot;/data/v2ray.crt&quot; ]]; then
        echo &quot;证书文件已存在&quot;
    elif [[ -f &quot;$HOME/.acme.sh/${domain}_ecc/${domain}.key&quot; &amp;&amp; -f &quot;$HOME/.acme.sh/${domain}_ecc/${domain}.cer&quot; ]]; then
        echo &quot;证书文件已存在&quot;
        &quot;$HOME&quot;/.acme.sh/acme.sh --installcert -d &quot;${domain}&quot; --fullchainpath /data/v2ray.crt --keypath /data/v2ray.key --ecc
        judge &quot;证书应用&quot;
    else
        ssl_install
        acme
    fi
}

nginx_systemd() {
    cat &gt;$nginx_systemd_file &lt;&lt;EOF
[Unit]
Description=The NGINX HTTP and reverse proxy server
After=syslog.target network.target remote-fs.target nss-lookup.target

[Service]
Type=forking
PIDFile=/etc/nginx/logs/nginx.pid
ExecStartPre=/etc/nginx/sbin/nginx -t
ExecStart=/etc/nginx/sbin/nginx -c ${nginx_dir}/conf/nginx.conf
ExecReload=/etc/nginx/sbin/nginx -s reload
ExecStop=/bin/kill -s QUIT \$MAINPID
PrivateTmp=true

[Install]
WantedBy=multi-user.target
EOF

    judge &quot;Nginx systemd ServerFile 添加&quot;
    systemctl daemon-reload
}

tls_type() {
    if [[ -f &quot;/etc/nginx/sbin/nginx&quot; ]] &amp;&amp; [[ -f &quot;$nginx_conf&quot; ]] &amp;&amp; [[ &quot;$shell_mode&quot; == &quot;ws&quot; ]]; then
        echo &quot;请选择支持的 TLS 版本（default:3）:&quot;
        echo &quot;请注意,如果你使用 Quantaumlt X / 路由器 / 旧版 Shadowrocket / 低于 4.18.1 版本的 V2ray core 请选择 兼容模式&quot;
        echo &quot;1: TLS1.1 TLS1.2 and TLS1.3（兼容模式）&quot;
        echo &quot;2: TLS1.2 and TLS1.3 (兼容模式)&quot;
        echo &quot;3: TLS1.3 only&quot;
        read -rp &quot;请输入：&quot; tls_version
        [[ -z ${tls_version} ]] &amp;&amp; tls_version=3
        if [[ $tls_version == 3 ]]; then
            sed -i &#39;s/ssl_protocols.*/ssl_protocols         TLSv1.3;/&#39; $nginx_conf
            echo -e &quot;${OK} ${GreenBG} 已切换至 TLS1.3 only ${Font}&quot;
        elif [[ $tls_version == 1 ]]; then
            sed -i &#39;s/ssl_protocols.*/ssl_protocols         TLSv1.1 TLSv1.2 TLSv1.3;/&#39; $nginx_conf
            echo -e &quot;${OK} ${GreenBG} 已切换至 TLS1.1 TLS1.2 and TLS1.3 ${Font}&quot;
        else
            sed -i &#39;s/ssl_protocols.*/ssl_protocols         TLSv1.2 TLSv1.3;/&#39; $nginx_conf
            echo -e &quot;${OK} ${GreenBG} 已切换至 TLS1.2 and TLS1.3 ${Font}&quot;
        fi
        systemctl restart nginx
        judge &quot;Nginx 重启&quot;
    else
        echo -e &quot;${Error} ${RedBG} Nginx 或 配置文件不存在 或当前安装版本为 h2 ，请正确安装脚本后执行${Font}&quot;
    fi
}
show_access_log() {
    [ -f ${v2ray_access_log} ] &amp;&amp; tail -f ${v2ray_access_log} || echo -e &quot;${RedBG}log文件不存在${Font}&quot;
}
show_error_log() {
    [ -f ${v2ray_error_log} ] &amp;&amp; tail -f ${v2ray_error_log} || echo -e &quot;${RedBG}log文件不存在${Font}&quot;
}
ssl_update_manuel() {
    [ -f ${amce_sh_file} ] &amp;&amp; &quot;/root/.acme.sh&quot;/acme.sh --cron --home &quot;/root/.acme.sh&quot; || echo -e &quot;${RedBG}证书签发工具不存在，请确认你是否使用了自己的证书${Font}&quot;
    domain=&quot;$(info_extraction &#39;\&quot;add\&quot;&#39;)&quot;
    &quot;$HOME&quot;/.acme.sh/acme.sh --installcert -d &quot;${domain}&quot; --fullchainpath /data/v2ray.crt --keypath /data/v2ray.key --ecc
}
bbr_boost_sh() {
    [ -f &quot;tcp.sh&quot; ] &amp;&amp; rm -rf ./tcp.sh
    wget -N --no-check-certificate &quot;https://github.com/ylx2016/Linux-NetSpeed/releases/download/sh/tcp.sh&quot; &amp;&amp; chmod +x tcp.sh &amp;&amp; ./tcp.sh
}
mtproxy_sh() {
    [ -f &quot;mtproxy_go.sh&quot; ] &amp;&amp; rm -rf ./mtproxy_go.sh
    wget -N --no-check-certificate https://github.com/whunt1/onekeymakemtg/raw/master/mtproxy_go.sh &amp;&amp; chmod +x mtproxy_go.sh &amp;&amp; ./mtproxy_go.sh
}

uninstall_all() {
    stop_process_systemd
    [[ -f $nginx_systemd_file ]] &amp;&amp; rm -f $nginx_systemd_file
    [[ -f $v2ray_systemd_file ]] &amp;&amp; rm -f $v2ray_systemd_file
    [[ -d $v2ray_bin_dir ]] &amp;&amp; rm -rf $v2ray_bin_dir
    if [[ -d $nginx_dir ]]; then
        echo -e &quot;${OK} ${Green} 是否卸载 Nginx [Y/N]? ${Font}&quot;
        read -r uninstall_nginx
        case $uninstall_nginx in
        [yY][eE][sS] | [yY])
            rm -rf $nginx_dir
            echo -e &quot;${OK} ${Green} 已卸载 Nginx ${Font}&quot;
            ;;
        *) ;;

        esac
    fi
    [[ -d $v2ray_conf_dir ]] &amp;&amp; rm -rf $v2ray_conf_dir
    [[ -d $web_dir ]] &amp;&amp; rm -rf $web_dir
    systemctl daemon-reload
    echo -e &quot;${OK} ${GreenBG} 已卸载，SSL证书文件已保留 ${Font}&quot;
}
delete_tls_key_and_crt() {
    [[ -f $HOME/.acme.sh/acme.sh ]] &amp;&amp; /root/.acme.sh/acme.sh uninstall &gt;/dev/null 2&gt;&amp;1
    [[ -d $HOME/.acme.sh ]] &amp;&amp; rm -rf &quot;$HOME/.acme.sh&quot;
    echo -e &quot;${OK} ${GreenBG} 已清空证书遗留文件 ${Font}&quot;
}
judge_mode() {
    if [ -f $v2ray_bin_dir/v2ray ]; then
        if grep -q &quot;ws&quot; $v2ray_qr_config_file; then
            shell_mode=&quot;ws&quot;
        elif grep -q &quot;h2&quot; $v2ray_qr_config_file; then
            shell_mode=&quot;h2&quot;
        fi
    fi
}
install_v2ray_ws_tls() {
    is_root
    check_system
    chrony_install
    dependency_install
    basic_optimization
    domain_check
    old_config_exist_check
    port_alterid_set
    v2ray_install
    port_exist_check 80
    port_exist_check &quot;${port}&quot;
    nginx_exist_check
    v2ray_conf_add_tls
    nginx_conf_add
    web_camouflage
    ssl_judge_and_install
    nginx_systemd
    vmess_qr_config_tls_ws
    basic_information
    vmess_qr_link_image
    tls_type
    show_information
    start_process_systemd
    enable_process_systemd
    acme_cron_update
}
install_v2_h2() {
    is_root
    check_system
    chrony_install
    dependency_install
    basic_optimization
    domain_check
    old_config_exist_check
    port_alterid_set
    v2ray_install
    port_exist_check 80
    port_exist_check &quot;${port}&quot;
    v2ray_conf_add_h2
    ssl_judge_and_install
    vmess_qr_config_h2
    basic_information
    vmess_qr_link_image
    show_information
    start_process_systemd
    enable_process_systemd

}
update_sh() {
    ol_version=$(curl -L -s https://raw.githubusercontent.com/wulabing/V2Ray_ws-tls_bash_onekey/${github_branch}/install.sh | grep &quot;shell_version=&quot; | head -1 | awk -F &#39;=|&quot;&#39; &#39;{print $3}&#39;)
    echo &quot;$ol_version&quot; &gt;$version_cmp
    echo &quot;$shell_version&quot; &gt;&gt;$version_cmp
    if [[ &quot;$shell_version&quot; &lt; &quot;$(sort -rV $version_cmp | head -1)&quot; ]]; then
        echo -e &quot;${OK} ${GreenBG} 存在新版本，是否更新 [Y/N]? ${Font}&quot;
        read -r update_confirm
        case $update_confirm in
        [yY][eE][sS] | [yY])
            wget -N --no-check-certificate https://raw.githubusercontent.com/wulabing/V2Ray_ws-tls_bash_onekey/${github_branch}/install.sh
            echo -e &quot;${OK} ${GreenBG} 更新完成 ${Font}&quot;
            exit 0
            ;;
        *) ;;

        esac
    else
        echo -e &quot;${OK} ${GreenBG} 当前版本为最新版本 ${Font}&quot;
    fi

}
maintain() {
    echo -e &quot;${RedBG}该选项暂时无法使用${Font}&quot;
    echo -e &quot;${RedBG}$1${Font}&quot;
    exit 0
}
list() {
    case $1 in
    tls_modify)
        tls_type
        ;;
    uninstall)
        uninstall_all
        ;;
    crontab_modify)
        acme_cron_update
        ;;
    boost)
        bbr_boost_sh
        ;;
    *)
        menu
        ;;
    esac
}

menu() {
    update_sh
    echo -e &quot;\t V2ray 安装管理脚本 ${Red}[${shell_version}]${Font}&quot;
    echo -e &quot;\t---authored by wulabing---&quot;
    echo -e &quot;\thttps://github.com/wulabing\n&quot;
    echo -e &quot;当前已安装版本:${shell_mode}\n&quot;

    echo -e &quot;—————————————— 安装向导 ——————————————&quot;&quot;&quot;
    echo -e &quot;${Green}0.${Font}  升级 脚本&quot;
    echo -e &quot;${Green}1.${Font}  安装 V2Ray (Nginx+ws+tls)&quot;
    echo -e &quot;${Green}2.${Font}  安装 V2Ray (http/2)&quot;
    echo -e &quot;${Green}3.${Font}  升级 V2Ray core&quot;
    echo -e &quot;—————————————— 配置变更 ——————————————&quot;
    echo -e &quot;${Green}4.${Font}  变更 UUID&quot;
    echo -e &quot;${Green}5.${Font}  变更 alterid&quot;
    echo -e &quot;${Green}6.${Font}  变更 port&quot;
    echo -e &quot;${Green}7.${Font}  变更 TLS 版本(仅ws+tls有效)&quot;
    echo -e &quot;—————————————— 查看信息 ——————————————&quot;
    echo -e &quot;${Green}8.${Font}  查看 实时访问日志&quot;
    echo -e &quot;${Green}9.${Font}  查看 实时错误日志&quot;
    echo -e &quot;${Green}10.${Font} 查看 V2Ray 配置信息&quot;
    echo -e &quot;—————————————— 其他选项 ——————————————&quot;
    echo -e &quot;${Green}11.${Font} 安装 4合1 bbr 锐速安装脚本&quot;
    echo -e &quot;${Green}12.${Font} 安装 MTproxy(支持TLS混淆)&quot;
    echo -e &quot;${Green}13.${Font} 证书 有效期更新&quot;
    echo -e &quot;${Green}14.${Font} 卸载 V2Ray&quot;
    echo -e &quot;${Green}15.${Font} 更新 证书crontab计划任务&quot;
    echo -e &quot;${Green}16.${Font} 清空 证书遗留文件&quot;
    echo -e &quot;${Green}17.${Font} 退出 \n&quot;

    read -rp &quot;请输入数字：&quot; menu_num
    case $menu_num in
    0)
        update_sh
        ;;
    1)
        shell_mode=&quot;ws&quot;
        install_v2ray_ws_tls
        ;;
    2)
        shell_mode=&quot;h2&quot;
        install_v2_h2
        ;;
    3)
        bash &lt;(curl -L -s https://install.direct/go.sh)
        ;;
    4)
        read -rp &quot;请输入UUID:&quot; UUID
        modify_UUID
        start_process_systemd
        ;;
    5)
        read -rp &quot;请输入alterID:&quot; alterID
        modify_alterid
        start_process_systemd
        ;;
    6)
        read -rp &quot;请输入连接端口:&quot; port
        if grep -q &quot;ws&quot; $v2ray_qr_config_file; then
            modify_nginx_port
        elif grep -q &quot;h2&quot; $v2ray_qr_config_file; then
            modify_inbound_port
        fi
        start_process_systemd
        ;;
    7)
        tls_type
        ;;
    8)
        show_access_log
        ;;
    9)
        show_error_log
        ;;
    10)
        basic_information
        vmess_qr_link_image
        show_information
        ;;
    11)
        bbr_boost_sh
        ;;
    12)
        mtproxy_sh
        ;;
    13)
        stop_process_systemd
        ssl_update_manuel
        start_process_systemd
        ;;
    14)
        uninstall_all
        ;;
    15)
        acme_cron_update
        ;;
    16)
        delete_tls_key_and_crt
        ;;
    17)
        exit 0
        ;;
    *)
        echo -e &quot;${RedBG}请输入正确的数字${Font}&quot;
        ;;
    esac
}

judge_mode
list &quot;$1&quot;
</code></pre>
        </div>
        <!-- .entry-content -->
        
        <p></p>
          
        <div style="text-align:center; width: 100%" class="social-share share-mobile" data-disabled="diandian, tencent"></div>
        
        <footer class="post-footer">
          
          <div class="post-lincenses"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="nofollow"><i class="fa fa-creative-commons" aria-hidden="true"></i> 知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a></div>
          
          <div class="post-tags">
          </div>
          <div class="post-share">
            <div class="social-share sharehidden share-component"></div>
            <i class="iconfont show-share icon-forward"></i>
          </div>
        </footer><!-- .entry-footer -->
        
      </article>
      <!-- #post-## -->
      <div class="toc" style="background: none;"></div>
      <section class="post-squares nextprev">
        
          
            <div class="post-nepre half previous">
          
            <a href="/whut-gclx-sy-02/" rel="prev">
              <div class="background">
                <img class="lazyload" src="" data-src="https://tva4.sinaimg.cn/large/87c01ec7gy1frmmzutd3fj21kw0w0kju.jpg" style="width: 100%; height: 100%; object-fit: cover; pointer-events: none;" onerror="imgError(this,3)" src="https://tva4.sinaimg.cn/large/87c01ec7gy1frmmzutd3fj21kw0w0kju.jpg">
              </div>
              <span class="label">
              Previous Post</span>
              <div class="info">
                <h3>
                工程力学实验02</h3>
                <hr>
              </div>
            </a>
          </div>
        
        
          
            <div class="post-nepre half next">
          
            <a href="/whut-gclx-sy-01/" rel="next">
              <div class="background">
                <img class="lazyload" src="" data-src="https://tva1.sinaimg.cn/large/0072Vf1pgy1foxk3qdi4cj31kw0w0kh2.jpg" style="width: 100%; height: 100%; object-fit: cover; pointer-events: none;" onerror="imgError(this,3)" src="https://tva1.sinaimg.cn/large/0072Vf1pgy1foxk3qdi4cj31kw0w0kh2.jpg">
              </div>
              <span class="label">
              Next Post</span>
              <div class="info">
                <h3>
                工程力学实验01</h3>
                <hr>
              </div>
            </a>
          </div>
        
      </section>
      
      <!-- 去掉文章最后的 作者 和 描述> -->
<!--       <section class="author-profile">
        <div class="info" itemprop="author" itemscope="" itemtype="https://schema.org/Person">
          <a href="/" class="profile gravatar"><img src="https://cdn.jsdelivr.net/gh/Leouas/cdn/img/custom/avatar.jpg" itemprop="image" alt="leouas" height="70" width="70"></a>
          <div class="meta">
            <span class="title">Author</span>
            <h3 itemprop="name">
            <a href="https://Leouas.top" itemprop="url" rel="author">leouas</a>
            </h3>
          </div>
        </div>
        <hr>
        <p><i class="iconfont icon-write"></i>Live your life with passion! With some drive!</p>
      </section> -->
    </main><!-- #main -->
  </div><!-- #primary -->
</div>



    </div>    
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something..."/>
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            // PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
    <!-- <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 Leouas<br>
      powered_by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer> -->
<footer id="colophon" class="site-footer" role="contentinfo">
    <div class="site-info">
        <div class="footertext">
            <div class="img-preload">
                <img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/other/wordpress-rotating-ball-o.svg">
                <img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/other/disqus-preloader.svg">
            </div>
            
                <p id="chakhsu"></p>
            
            <p>本站总访问量：<a id="allcount"></a></p>
            <p style="color: #666666;"></p>
            
                <p id="momk" style="font-family: 'Ubuntu', sans-serif;color: #b9b9b9;"></p>
            
        </div>
        <div class="footer-device">
            <p style="font-family: 'Ubuntu', sans-serif;">
 <span style="">Theme <a href="https://github.com/xbclub/Hexo-theme-sakura" target="_blank"
                         style="color: #b9b9b9;;text-decoration: underline dotted rgba(0, 0, 0, .1);">Sakura</a> <i
             class="iconfont icon-sakura rotating" style="color: #ffc0cb;display:inline-block"></i> by <a
             href="https://2heng.xin/" target="_blank"
             style="color: #b9b9b9;;text-decoration: underline dotted rgba(0, 0, 0, .1);">Mashiro</a>&<a
             href="https://www.hojun.cn/" target="_blank"
             style="color: #b9b9b9;;text-decoration: underline dotted rgba(0, 0, 0, .1);">Hojun</a>&<a
             href="https://Leouas.top/" target="_blank"
             style="color: #b9b9b9;;text-decoration: underline dotted rgba(0, 0, 0, .1);">Leouas, Powered by Hexo</a>
        </span>
            </p>
        </div>
    </div><!-- .site-info -->
</footer>


<!--<script src="https://cdn.jsdelivr.net/gh/xbclub/staticCDN@0.7/js/tocbot.min.js"></script>-->

<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/xbclub/staticCDN@0.8/js/lib.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/xbclub/staticCDN@0.8/js/InsightSearch.js"></script>
<script type="text/javascript"
        src="https://cdn.jsdelivr.net/gh/xbclub/staticCDN@0.8/js/jquery.fancybox.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/xbclub/staticCDN@0.8/js/zoom.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/Leouas/cdn/js/sakura-app.js"></script>
<script src="https://cdn.jsdelivr.net/gh/xbclub/staticCDN@0.8/js/av-min.js"></script>
<script src='https://cdn.jsdelivr.net/gh/xbclub/staticCDN@0.8/js/Valine.min.js'></script>
<script src="https://cdn.jsdelivr.net/gh/xbclub/staticCDN@0.8/js/botui.js"></script>
<!-- 不蒜子 网页计数器 -->

      
       <script>
  fetch('https://counts.42cloud.cn/api/counts.html')
        .then(response => response.json())
        .then(data => {
              if (document.getElementById("readcount")) {
                document.getElementById("readcount").innerHTML=data.Count;
            }
            if (document.getElementById("allcount")){
                document.getElementById("allcount").innerHTML=data.Allcount;
            }
        })
        .catch(err => console.error(err))
</script>
      
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script> -->
<script type="text/javascript">
    /* <![CDATA[ */
    if (/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)) {
        var Poi = {
            "pjax": "1",
            "movies": {"url": "https://cdn.jsdelivr.net/gh/honjun/hojun@1.2", "name": "Unbroken.mp4", "live": "close"},
            "windowheight": "fixed",
            "codelamp": "close",
            "ajaxurl": "",
            "order": "asc",
            "formpostion": "bottom"
        };
    } else {
        var Poi = {
            "pjax": "1",
            "movies": {"url": "https://cdn.jsdelivr.net/gh/honjun/hojun@1.2", "name": "Unbroken.mp4", "live": "open"},
            "windowheight": "auto",
            "codelamp": "close",
            "ajaxurl": "",
            "order": "asc",
            "formpostion": "bottom"
        };
    }
    /* ]]> */

</script>
<script>
    $(document).ready(function () {
        if ($(".toc").length > 0 && document.body.clientWidth > 1200) {
            if ($(".pattern-center").length > 0) { //有图的情况
                tocbot.init({
                    // Where to render the table of contents.
                    tocSelector: '.toc', // 放置目录的容器
                    // Where to grab the headings to build the table of contents.
                    contentSelector: '.entry-content', // 正文内容所在
                    // Which headings to grab inside of the contentSelector element.
                    scrollSmooth: true,
                    headingSelector: 'h1, h2, h3, h4, h5', // 需要索引的标题级别
                    headingsOffset: -400,
                    scrollSmoothOffset: -85
                });
            } else {
                tocbot.init({
                    // Where to render the table of contents.
                    tocSelector: '.toc', // 放置目录的容器
                    // Where to grab the headings to build the table of contents.
                    contentSelector: '.entry-content', // 正文内容所在
                    // Which headings to grab inside of the contentSelector element.
                    scrollSmooth: true,
                    headingSelector: 'h1, h2, h3, h4, h5', // 需要索引的标题级别
                    headingsOffset: -85,
                    scrollSmoothOffset: -85
                });
            }
            var offsetTop = $('.toc').offset().top - 95;
            window.onscroll = function () {
                var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop;
                if (scrollTop >= offsetTop) {
                    $('.toc').addClass('toc-fixed');
                } else {
                    $('.toc').removeClass('toc-fixed');
                }
            }
        }
    });
</script>

    <script type="text/javascript">
        function NewDate(str) {
            str = str.split('-');
            var date = new Date();
            date.setUTCFullYear(str[0], str[1] - 1, str[2]);
            date.setUTCHours(0, 0, 0, 0);
            return date;
        }

        function momxc() {
            var birthDay = NewDate("2020-2-22");
            var today = new Date();
            var timeold = today.getTime() - birthDay.getTime();
            var sectimeold = timeold / 1000
            var secondsold = Math.floor(sectimeold);
            var msPerDay = 24 * 60 * 60 * 1000;
            var e_daysold = timeold / msPerDay;
            var daysold = Math.floor(e_daysold);
            var e_hrsold = (daysold - e_daysold) * -24;
            var hrsold = Math.floor(e_hrsold);
            var e_minsold = (hrsold - e_hrsold) * -60;
            var minsold = Math.floor((hrsold - e_hrsold) * -60);
            var seconds = Math.floor((minsold - e_minsold) * -60).toString();
            document.getElementById("momk").innerHTML = "本站已安全运行" + daysold + "天" + hrsold + "小时" + minsold + "分" + seconds + "秒";
            setTimeout(momxc, 1000);
        }

        momxc();
    </script>



    <script type="text/javascript">
        fetch('https://v1.hitokoto.cn')
            .then(response => response.json())
            .then(data => {
                chakhsu(document.getElementById("chakhsu"), data.hitokoto);
            })
            .catch(err => console.error(err));


        // 文字循环处理 两个参数，第一个是需要显示在哪个标签内append 以id为选择器，第二个参数是 要处理的文字
        function chakhsu(r, text) {
            function t() {
                return b[Math.floor(Math.random() * b.length)];
            }

            function e() {
                return String.fromCharCode(94 * Math.random() + 33);
            }

            function n(r) {
                for (var n = document.createDocumentFragment(), i = 0; r > i; i++) {
                    var l = document.createElement("span");
                    (l.textContent = e()), (l.style.color = t()), n.appendChild(l);
                }
                return n;
            }

            function i() {
                var t = o[c.skillI];
                c.step
                    ? c.step--
                    : ((c.step = g),
                        c.prefixP < l.length
                            ? (c.prefixP >= 0 && (c.text += l[c.prefixP]), c.prefixP++)
                            : "forward" === c.direction
                            ? c.skillP < t.length
                                ? ((c.text += t[c.skillP]), c.skillP++)
                                : c.delay
                                    ? c.delay--
                                    : ((c.direction = "backward"), (c.delay = a))
                            : c.skillP > 0
                                ? ((c.text = c.text.slice(0, -1)), c.skillP--)
                                : ((c.skillI = (c.skillI + 1) % o.length),
                                    (c.direction = "forward"))),
                    (r.textContent = c.text),
                    r.appendChild(
                        n(
                            c.prefixP < l.length
                                ? Math.min(s, s + c.prefixP)
                                : Math.min(s, t.length - c.skillP)
                        )
                    ),
                    setTimeout(i, d);
            }

            /*以下内容自定义修改*/
            var l = "",
                o = [text].map(function (r) {
                    return r + "";
                }),
                a = 3,
                g = 1,
                s = 5,
                d = 75,
                b = [
                    "rgb(110,64,170)",
                    "rgb(150,61,179)",
                    "rgb(191,60,175)",
                    "rgb(228,65,157)",
                    "rgb(254,75,131)",
                    "rgb(255,94,99)",
                    "rgb(255,120,71)",
                    "rgb(251,150,51)",
                    "rgb(226,183,47)",
                    "rgb(198,214,60)",
                    "rgb(175,240,91)",
                    "rgb(127,246,88)",
                    "rgb(82,246,103)",
                    "rgb(48,239,130)",
                    "rgb(29,223,163)",
                    "rgb(26,199,194)",
                    "rgb(35,171,216)",
                    "rgb(54,140,225)",
                    "rgb(76,110,219)",
                    "rgb(96,84,200)"
                ],
                c = {
                    text: "",
                    prefixP: -s,
                    skillI: 0,
                    skillP: 0,
                    direction: "forward",
                    delay: a,
                    step: g
                };
            i();
        }
    </script>

    <div class="openNav no-select" style="height: 50px;">
      <div class="iconflat no-select" style="width: 50px; height: 50px;">
        <div class="icon"></div>
      </div>
      <div class="site-branding search-form-submit">
        <i class="iconfont js-toggle-search iconsearch icon-search"></i>
      </div>
    </div>
  </section>
  <div id="mo-nav" class="">
  <div class="m-avatar">
    <img src="https://cdn.jsdelivr.net/gh/Leouas/cdn/img/custom/avatar.jpg">
  </div>
  <p style="text-align: center; color: #333; font-weight: 900; font-family: 'Ubuntu', sans-serif; letter-spacing: 1.5px">さくら荘そのleouas</p>
  <p style="text-align: center; word-spacing: 20px;">
    
      
        <a href="http://github.com/Leouas" class="fa fa-github" target="_blank" style="color: #333; margin-left:20px"></a>
      
        <a href="https://wpa.qq.com/msgrd?v=3&uin=1727352151&site=qq&menu=yes" class="fa fa-qq" target="_blank" style="color: #25c6fe; margin-left:20px"></a>
      
    
  </p>
  <ul id="menu-new-1" class="menu">
    
      <li>
        <a href="/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-fort-awesome faa-shake" aria-hidden="true"></i>
            首页
          </span>
        </a>
        
      </li>
    
      <li>
        <a href="javascript:;">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-archive faa-shake" aria-hidden="true"></i>
            分类
          </span>
        </a>
        
          <ul class="sub-menu">
            
              <li>
                <a href="/categories/geek/">
                  <i class="fa fa-code" aria-hidden="true"></i>
                  技术
                </a>
              </li>
            
              <li>
                <a href="/categories/whut/">
                  <i class="fa fa-file-text-o" aria-hidden="true"></i>
                  学习
                </a>
              </li>
            
              <li>
                <a href="/categories/share/">
                  <i class="fa fa-commenting-o" aria-hidden="true"></i>
                  随想
                </a>
              </li>
            
              <li>
                <a href="/categories/mics/">
                  <i class="fa fa-music" aria-hidden="true"></i>
                  媒体
                </a>
              </li>
            
          </ul>
        
      </li>
    
      <li>
        <a href="javascript:;">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-list-ul faa-vertical" aria-hidden="true"></i>
            清单
          </span>
        </a>
        
          <ul class="sub-menu">
            
              <li>
                <a href="/categories/books/">
                  <i class="fa fa-th-list faa-bounce" aria-hidden="true"></i>
                  书单
                </a>
              </li>
            
              <li>
                <a href="/bangumi/">
                  <i class="fa fa-film faa-vertical" aria-hidden="true"></i>
                  番组
                </a>
              </li>
            
              <li>
                <a href="/playlist/">
                  <i class="fa fa-headphones" aria-hidden="true"></i>
                  歌单
                </a>
              </li>
            
              <li>
                <a href="https://huaban.com/sayk/pins/" target="_blank" rel="noopener">
                  <i class="fa fa-photo" aria-hidden="true"></i>
                  图集
                </a>
              </li>
            
          </ul>
        
      </li>
    
      <li>
        <a href="/archives">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-archive faa-shake" aria-hidden="true"></i>
            归档
          </span>
        </a>
        
      </li>
    
      <li>
        <a href="/tags">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-tags" aria-hidden="true"></i>
            标签
          </span>
        </a>
        
      </li>
    
      <li>
        <a href="/comment/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-pencil-square-o faa-tada" aria-hidden="true"></i>
            留言
          </span>
        </a>
        
      </li>
    
      <li>
        <a href="javascript:;">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-leaf faa-wrench" aria-hidden="true"></i>
            关于
          </span>
        </a>
        
          <ul class="sub-menu">
            
              <li>
                <a href="/donate/">
                  <i class="fa fa-heart faa-pulse" aria-hidden="true"></i>
                  赞赏
                </a>
              </li>
            
              <li>
                <a href="/about/">
                  <i class="fa fa-meetup" aria-hidden="true"></i>
                  我？
                </a>
              </li>
            
          </ul>
        
      </li>
    
      <li>
        <a href="/links/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-link faa-shake" aria-hidden="true"></i>
            友人帐
          </span>
        </a>
        
      </li>
    
      <li>
        <a href="/atom.xml">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-rss faa-pulse" aria-hidden="true"></i>
            RSS
          </span>
        </a>
        
      </li>
    
  </ul>
  <p style="text-align: center; font-size: 13px; color: #b9b9b9;">&copy 2019 hexo-sakura</p>
</div>
<button onclick="topFunction()" class="mobile-cd-top" id="moblieGoTop" title="Go to top" style="display: none;"><i class="fa fa-chevron-up" aria-hidden="true"></i></button>
  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css">
<script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script>
<!-- require MetingJS -->
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>
<style>
  .aplayer .aplayer-lrc {
    height: 35px;
  }
  .aplayer .aplayer-lrc p{
    font-size: 16px;
    font-weight: 700;
    line-height: 18px !important;
  }
  .aplayer .aplayer-lrc p.aplayer-lrc-current{
    color: #FF1493;
  }
  .aplayer.aplayer-narrow .aplayer-body{
    left: -66px !important;
  }
  .aplayer.aplayer-fixed .aplayer-lrc {
    display: none;
  }
  .aplayer .aplayer-lrc.aplayer-lrc-hide {
      display:none !important;
  }
  .aplayer.aplayer-fixed .lrc-show {
    display: block;
    background: rgba(255, 255, 255, 0.8);
  }
</style>
<meting-js

    meting="true"

    switch="true"

    id="2288037900"

    server="netease"

    type="playlist"

    fixed="true"

    autoplay="false"

    loop="all"

    order="random"

    preload="auto"

    volume="0.7"

    mutex="true"

</meting-js>
<script>
  $(function(){
    $('body').on('click', '.aplayer', function(){
      if($('.aplayer-button').hasClass('aplayer-play')) {
        $('.aplayer-lrc').removeClass('lrc-show');
      } else {
        $('.aplayer-lrc').addClass('lrc-show');
      }
    })
  });
</script>
  
  <div class="skin-menu no-select" id="mainskin" style="position: fixed">
 <div class="theme-controls row-container">
  <ul class="menu-list">
   <li id="white-bg"> <i class="fa fa-television" aria-hidden="true"></i></li>
   <li id="sakura-bg"> <i class="iconfont icon-sakura"></i></li>
   <li id="gribs-bg"> <i class="fa fa-slack" aria-hidden="true"></i></li>
   <li id="KAdots-bg"> <i class="iconfont icon-dots"></i></li>
   <li id="totem-bg"> <i class="fa fa-optin-monster" aria-hidden="true"></i></li>
   <li id="pixiv-bg"> <i class="iconfont icon-pixiv"></i></li>
   <li id="bing-bg"> <i class="iconfont icon-bing"></i></li>
   <li id="dark-bg"> <i class="fa fa-moon-o" aria-hidden="true"></i></li>
  </ul>
 </div>
</div>
<canvas id="night-mode-cover"></canvas>
 
  <div class="changeSkin-gear no-select">
  <div class="keys" id="setbtn"> 
   <span id="open-skinMenu"> 切换主题 | SCHEME TOOL  
     <i class="iconfont icon-gear inline-block rotating"></i> 
   </span>
  </div>
</div>

</body>
</html>
